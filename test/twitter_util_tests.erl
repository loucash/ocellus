-module(twitter_util_tests).
-export([get_rate_limit_test/0]).

get_rate_limit_test() ->
  Blob = {1, {[{<<"rate_limit_context">>, % Drift is 1 here
   {[{<<"access_token">>,
      <<"16145405-OHVqHZ2uSfdgtydJIeL1Np6npW3Utdt1nWswGX2pt">>}]}},
  {<<"resources">>,
   {[{<<"users">>,
      {[{<<"/users/profile_banner">>,
         {[{<<"limit">>,180},
           {<<"remaining">>,180},
           {<<"reset">>,1405797670}]}},
        {<<"/users/suggestions/:slug/members">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}},
        {<<"/users/show/:id">>,
         {[{<<"limit">>,180},
           {<<"remaining">>,179},
           {<<"reset">>,1405797494}]}},
        {<<"/users/suggestions">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}},
        {<<"/users/lookup">>,
         {[{<<"limit">>,180},
           {<<"remaining">>,180},
           {<<"reset">>,1405797670}]}},
        {<<"/users/search">>,
         {[{<<"limit">>,180},
           {<<"remaining">>,180},
           {<<"reset">>,1405797670}]}},
        {<<"/users/contributors">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}},
        {<<"/users/contributees">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}},
        {<<"/users/suggestions/:slug">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}}]}},
     {<<"followers">>,
      {[{<<"/followers/list">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}},
        {<<"/followers/ids">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}}]}},
     {<<"statuses">>,
      {[{<<"/statuses/mentions_timeline">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}},
        {<<"/statuses/lookup">>,
         {[{<<"limit">>,180},
           {<<"remaining">>,180},
           {<<"reset">>,1405797670}]}},
        {<<"/statuses/show/:id">>,
         {[{<<"limit">>,180},
           {<<"remaining">>,180},
           {<<"reset">>,1405797670}]}},
        {<<"/statuses/oembed">>,
         {[{<<"limit">>,180},
           {<<"remaining">>,180},
           {<<"reset">>,1405797670}]}},
        {<<"/statuses/retweeters/ids">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}},
        {<<"/statuses/home_timeline">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}},
        {<<"/statuses/user_timeline">>,
         {[{<<"limit">>,180},
           {<<"remaining">>,180},
           {<<"reset">>,1405797670}]}},
        {<<"/statuses/retweets/:id">>,
         {[{<<"limit">>,60},
           {<<"remaining">>,60},
           {<<"reset">>,1405797670}]}},
        {<<"/statuses/retweets_of_me">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}}]}},
     {<<"friends">>,
      {[{<<"/friends/ids">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,150},
           {<<"reset">>,1505797670}]}},
        {<<"/friends/list">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}},
        {<<"/friends/following/ids">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}},
        {<<"/friends/following/list">>,
         {[{<<"limit">>,15},
           {<<"remaining">>,15},
           {<<"reset">>,1405797670}]}}]}}]}}]}},
  % need to match on {Remaining, ResetTs + Drift}
  {150, 1505797671} = twitter_util:get_rate_limit(<<"/friends/ids">>,Blob),
  {179, 1405797495} = twitter_util:get_rate_limit(<<"/users/show/:id">>,Blob).
